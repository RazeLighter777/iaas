apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: vaultwarden
  namespace: vaultwarden
spec:
  hosts:
    - vaultwarden.${domain_name}
  gateways:
    - istio-system/istio-ingressgateway
  http:
    - match:
        - authority:
            exact: vaultwarden.${domain_name}
          uri:
            prefix: /
      headers:
        request:
          set:
            X-Forwarded-Proto: "https"
            X-Forwarded-Host: "vaultwarden.${domain_name}"
            X-Forwarded-Port: "443"
      route:
        - destination:
            host: vaultwarden.vaultwarden.svc.cluster.local
            port:
              number: 80
